<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LABIIZ - Almacen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "lab-purple": "rgb(149,47,87)",
              "lab-table": "rgb(255,255,255)",
              "lab-light-purple": "#952f57",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-100">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <aside class="w-64 bg-white shadow-lg">
        <div class="p-6 border-b text-center">
          <h1 class="text-6xl font-bold text-gray-800">LABIIZ</h1>
          <p class="text-gray-500">UPIIZ-IPN</p>
          <div class="flex justify-center mt-2">
            <img
              src="{{ url_for('static', filename='ingalim.png') }}"
              alt="Logo grande LABIIZ"
              class="w-24 h-24 object-contain"
            />
          </div>
        </div>
        <nav class="mt-6">
          <div class="px-4 space-y-2">
            <a
              href="/dashboard"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-home"></i><span>Inicio</span>
            </a>
            <a
              href="/almacen"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-boxes"></i><span>Almac√©n</span>
            </a>
            <a
              href="/citas"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-vial"></i><span>Citas de laboratorio</span>
            </a>
            <a
              href="/inventario"
              class="flex items-center space-x-3 px-4 py-3 bg-lab-purple text-white rounded-lg"
            >
              <i class="fas fa-chart-bar"></i><span>Inventario</span>
            </a>
            <a
              href="/tickets"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-ticket-alt"></i><span>Vales de laboratorio</span>
            </a>
          </div>
        </nav>
        <div class="absolute bottom-4 left-4">
          <button
            class="flex items-center space-x-2 text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-question-circle"></i
            ><span class="text-sm">Ayuda</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 overflow-hidden">
        <header
          class="bg-lab-purple text-white px-6 py-4 flex justify-between items-center"
        >
          <h2 class="text-xl font-semibold">Inventario</h2>
          <div class="flex items-center space-x-4">
            <span class="text-sm">{{ usuario }}</span>
            <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                <i class="fas fa-user text-[#852747]"></i>
            </div>
            <!-- Bot√≥n de cerrar sesi√≥n -->
    <a href="{{ url_for('logout') }}"
   class="bg-white text-black px-3 py-1 rounded-full flex items-center space-x-2 hover:bg-gray-200 transition">
  <i class="fas fa-sign-out-alt text-lab-purple"></i>
  <span class="text-sm font-medium">Cerrar sesi√≥n</span>
</a>
        </header>

        <div class="p-6 overflow-y-auto h-full">
          <!-- Search and Action Buttons -->
          <div class="mb-6 flex justify-between items-center">
            <div class="flex items-center space-x-4">
              <div class="relative">
                <i
                  class="fas fa-search absolute left-3 top-3 text-gray-400"
                ></i>
                <input
                  type="text"
                  placeholder="Buscar producto"
                  class="pl-10 pr-4 py-2 border border-gray-300 rounded-full w-80 focus:outline-none focus:ring-2 focus:ring-lab-purple"
                  id="searchInput"
                />
              </div>
              <div class="flex items-center space-x-2">
                <i class="fas fa-chart-line text-blue-500 text-2xl"></i>
                <i class="fas fa-chart-bar text-orange-500 text-2xl"></i>
              </div>
              <div class="flex items-center space-x-4 mb-4">
  <button id="btnMateriales" class="bg-lab-purple text-white px-4 py-2 rounded-lg hover:bg-lab-purple-dark transition">
    Materiales
  </button>
  <button id="btnReactivos" class="bg-gray text-black px-4 py-2 rounded-lg hover:bg-lab-purple-dark transition">
    Reactivos
  </button>
  <button id="btnAlertas" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
    Ver alertas
  </button>
</div>
            </div>
          </div>

          <!-- Color Buttons (solo para Reactivos) -->
          <div id="colorButtons" class="flex space-x-2 mt-4 hidden">
            <button id="btnMostrarTodos" class="bg-gray-400 text-white px-3 py-1 rounded">Todos</button>
            <button class="bg-green-500 text-white px-3 py-1 rounded">
              Verde
            </button>
            <button class="bg-yellow-800 text-white px-3 py-1 rounded">
              Caf√©
            </button>
            <button class="bg-blue-500 text-white px-3 py-1 rounded">
              Azul
            </button>
            <button class="bg-yellow-400 text-white px-3 py-1 rounded">
              Amarillo
            </button>
            <button
              class="bg-white border border-gray-400 px-3 py-1 rounded text-gray-700"
            >
              Blanco
            </button>
            <button class="bg-red-500 text-white px-3 py-1 rounded">
              Rojo
            </button>
          </div>

         



          <!-- Tabla de Materiales -->
<div id="tablaMateriales" class="bg-white rounded-lg shadow mt-4">
  <div class="overflow-x-auto">
    <div class="max-h-[400px] overflow-y-auto">  <!-- üîπ Scroll vertical -->
      <table class="w-full">
            <thead class="bg-lab-table text-black">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad disponible</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Localizaci√≥n</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Capacidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de ingreso</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Observaciones</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for m in materiales %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.nombre }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.cantidad }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.cantidad_disponible }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.localizacion }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.capacidad }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.fecha_ingreso }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.observaciones }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        <button class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-edit"></i></button>
                        <button class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
              </table>
    </div>
  </div>
</div>




<!-- Tabla de Reactivos -->
<div id="tablaReactivos" class="bg-white rounded-lg shadow mt-4 hidden">
  <div class="overflow-x-auto">
    <div class="max-h-[400px] overflow-y-auto"> <!-- üîπ Scroll vertical -->
      <table class="w-full">
            <thead class="bg-lab-table text-black">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Color</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad en buen estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad disponible</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Localizaci√≥n</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Capacidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de ingreso</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de caducidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Acciones</th>
                </tr>
            </thead>
            <tbody>
  {% for r in reactivos %}
  <tr class="hover:bg-gray-50" data-color="{{ r.color|lower }}">
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.nombre }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.color }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad_buen_estado }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad_disponible }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.localizacion }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.capacidad }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.fecha_ingreso }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.fecha_caducidad }}</td>
  </tr>
  {% endfor %}
</tbody>

              </table>
    </div>
  </div>
</div>



          <!-- Descargar -->
          <div class="mt-6">
            <button
              class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors"
            >
              <i class="fas fa-download mr-2"></i>Descargar excel
            </button>
          </div>
        </div>
      </main>
    </div>

<!-- Modal de Alertas -->
<div id="modalAlertas" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-[600px] max-h-[80vh] overflow-y-auto p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">‚ö†Ô∏è Alertas de inventario</h2>

    {% if stock_bajo_materiales or caducidad_proxima_materiales or stock_bajo_reactivos or caducidad_proxima_reactivos %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4 rounded shadow">

      <!-- üîπ MATERIALES -->
      {% if stock_bajo_materiales or caducidad_proxima_materiales %}
      <div class="mb-3">
        <p class="font-semibold text-yellow-700">üß™ Materiales:</p>

        {% if stock_bajo_materiales %}
        <ul class="list-disc ml-6 text-yellow-900 mb-2">
          <li class="font-semibold">Stock bajo:</li>
          {% for item in stock_bajo_materiales %}
            <li>{{ item.nombre }} ‚Äî Stock actual: {{ item.cantidad }} (m√≠nimo: {{ item.minimo }})</li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if caducidad_proxima_materiales %}
        <ul class="list-disc ml-6 text-orange-800">
          <li class="font-semibold">Pr√≥ximos a caducar:</li>
          {% for item in caducidad_proxima_materiales %}
            <li>{{ item.nombre }} ({{ item.fecha_caducidad }})</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      {% endif %}

      <!-- üîπ REACTIVOS -->
      {% if stock_bajo_reactivos or caducidad_proxima_reactivos %}
      <div>
        <p class="font-semibold text-yellow-700">‚öóÔ∏è Reactivos:</p>

        {% if stock_bajo_reactivos %}
        <ul class="list-disc ml-6 text-yellow-900 mb-2">
          <li class="font-semibold">Stock bajo:</li>
          {% for item in stock_bajo_reactivos %}
            <li>{{ item.nombre }} ‚Äî Stock actual: {{ item.cantidad }} (m√≠nimo: {{ item.minimo }})</li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if caducidad_proxima_reactivos %}
        <ul class="list-disc ml-6 text-orange-800">
          <li class="font-semibold">Pr√≥ximos a caducar:</li>
          {% for item in caducidad_proxima_reactivos %}
            <li>{{ item.nombre }} ({{ item.fecha_caducidad }})</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% else %}
      <p class="text-gray-600 text-center">‚úÖ No hay alertas por el momento.</p>
    {% endif %}

    <div class="text-center mt-6">
      <button id="cerrarModalAlertas" class="bg-lab-purple text-white px-5 py-2 rounded-lg hover:bg-lab-purple-dark transition">
        Cerrar
      </button>
    </div>
  </div>
</div>


<script>
  const btnMateriales = document.getElementById("btnMateriales");
  const btnReactivos = document.getElementById("btnReactivos");
  const tablaMateriales = document.getElementById("tablaMateriales");
  const tablaReactivos = document.getElementById("tablaReactivos");
  const colorButtons = document.getElementById("colorButtons");

  // üîπ Alternar entre Materiales y Reactivos
  btnMateriales.addEventListener("click", () => {
    tablaMateriales.classList.remove("hidden");
    tablaReactivos.classList.add("hidden");
    colorButtons.classList.add("hidden");

    btnMateriales.classList.add("bg-lab-purple", "text-white");
    btnMateriales.classList.remove("bg-gray-200", "text-gray-700");
    btnReactivos.classList.add("bg-gray-200", "text-gray-700");
    btnReactivos.classList.remove("bg-lab-purple", "text-white");
  });

  btnReactivos.addEventListener("click", () => {
    tablaReactivos.classList.remove("hidden");
    tablaMateriales.classList.add("hidden");
    colorButtons.classList.remove("hidden");

    btnReactivos.classList.add("bg-lab-purple", "text-white");
    btnReactivos.classList.remove("bg-gray-200", "text-gray-700");
    btnMateriales.classList.add("bg-gray-200", "text-gray-700");
    btnMateriales.classList.remove("bg-lab-purple", "text-white");
  });


  // üîπ Filtro por color (para reactivos)
  const colorButtonsContainer = document.getElementById("colorButtons");
  const reactivoRows = document.querySelectorAll("#tablaReactivos tbody tr");

  colorButtonsContainer.querySelectorAll("button").forEach((btn) => {
    btn.addEventListener("click", () => {
      const color = btn.textContent.trim().toLowerCase();

      reactivoRows.forEach((row) => {
        const rowColor = row.dataset.color?.toLowerCase() || "";
        if (color === "todos") {
          row.style.display = "";
        } else if (color === "blanco") {
          row.style.display = rowColor === "blanco" ? "" : "none";
        } else {
          row.style.display = rowColor.includes(color) ? "" : "none";
        }
      });
    });
  });

  // üîπ B√∫squeda din√°mica
  document.getElementById("searchInput").addEventListener("input", (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const visibleTable = tablaMateriales.classList.contains("hidden")
      ? tablaReactivos
      : tablaMateriales;
    const rows = visibleTable.querySelectorAll("tbody tr");
    rows.forEach((row) => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(searchTerm) ? "" : "none";
    });
  });

  // üîπ Editar y Eliminar (demo)
  document.querySelectorAll(".fa-edit").forEach((button) => {
    button.addEventListener("click", () => {
      alert("Editar producto - Funcionalidad por implementar");
    });
  });
  document.querySelectorAll(".fa-trash").forEach((button) => {
    button.addEventListener("click", function () {
      if (confirm("¬øEst√°s seguro de eliminar este producto?")) {
        this.closest("tr").remove();
      }
    });
  });

  const btnAlertas = document.getElementById('btnAlertas');
  const modalAlertas = document.getElementById('modalAlertas');
  const cerrarModalAlertas = document.getElementById('cerrarModalAlertas');

  btnAlertas.addEventListener('click', () => {
    modalAlertas.classList.remove('hidden');
  });

  cerrarModalAlertas.addEventListener('click', () => {
    modalAlertas.classList.add('hidden');
  });

  // Cerrar el modal si se hace clic fuera del contenido
  modalAlertas.addEventListener('click', (e) => {
    if (e.target === modalAlertas) {
      modalAlertas.classList.add('hidden');
    }
  });
</script>

 


  </body>
</html>
