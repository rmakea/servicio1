<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LABIIZ - Almacen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "lab-purple": "rgb(149,47,87)",
              "lab-table": "rgb(255,255,255)",
              "lab-light-purple": "#952f57",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-100">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <aside class="w-64 bg-white shadow-lg">
        <div class="p-6 border-b text-center">
          <h1 class="text-6xl font-bold text-gray-800">LABIIZ</h1>
          <p class="text-gray-500">UPIIZ-IPN</p>
          <div class="flex justify-center mt-2">
            <img
              src="{{ url_for('static', filename='ingalim.png') }}"
              alt="Logo grande LABIIZ"
              class="w-24 h-24 object-contain"
            />
          </div>
        </div>
        <nav class="mt-6">
          <div class="px-4 space-y-2">
            <a
              href="/inicio"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-home"></i><span>Inicio</span>
            </a>
            <a
              href="/almacen"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-boxes"></i><span>Almac√©n</span>
            </a>
            <a
              href="/citas"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-vial"></i><span>Citas de laboratorio</span>
            </a>
            <a
              href="/inventario"
              class="flex items-center space-x-3 px-4 py-3 bg-lab-purple text-white rounded-lg"
            >
              <i class="fas fa-chart-bar"></i><span>Inventario</span>
            </a>
            <a
              href="/tickets"
              class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <i class="fas fa-ticket-alt"></i><span>Vales de laboratorio</span>
            </a>
          </div>
        </nav>
        <div class="absolute bottom-4 left-4">
          <button
            class="flex items-center space-x-2 text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-question-circle"></i
            ><span class="text-sm">Ayuda</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 overflow-hidden">
        <header
          class="bg-lab-purple text-white px-6 py-4 flex justify-between items-center"
        >
          <h2 class="text-xl font-semibold">Inventario</h2>
          <div class="flex items-center space-x-4">
            <span class="text-sm">{{ usuario }}</span>
            <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                <i class="fas fa-user text-[#852747]"></i>
            </div>
            <!-- Bot√≥n de cerrar sesi√≥n -->
    <a href="{{ url_for('logout') }}"
   class="bg-white text-black px-3 py-1 rounded-full flex items-center space-x-2 hover:bg-gray-200 transition">
  <i class="fas fa-sign-out-alt text-lab-purple"></i>
  <span class="text-sm font-medium">Cerrar sesi√≥n</span>
</a>
        </header>

        <div class="p-6 overflow-y-auto h-full">
          <!-- Search and Action Buttons -->
          <div class="mb-6 flex justify-between items-center">
            <div class="flex items-center space-x-4">
              <div class="relative">
                <i
                  class="fas fa-search absolute left-3 top-3 text-gray-400"
                ></i>
                <input
                  type="text"
                  placeholder="Buscar producto"
                  class="pl-10 pr-4 py-2 border border-gray-300 rounded-full w-80 focus:outline-none focus:ring-2 focus:ring-lab-purple"
                  id="searchInput"
                />
              </div>
              <div class="flex items-center space-x-2">
                <i class="fas fa-chart-line text-blue-500 text-2xl"></i>
                <i class="fas fa-chart-bar text-orange-500 text-2xl"></i>
              </div>
              <div class="flex items-center space-x-2">
                <button
                  id="btnMateriales"
                  class="bg-lab-purple text-white px-4 py-2 rounded-lg hover:bg-lab-light-purple"
                >
                  Materiales
                </button>
                <button
                  id="btnReactivos"
                  class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300"
                >
                  Reactivos
                </button>
              </div>

              <!-- üîπ Contador de pr√≥ximos a caducar (solo visible en vista de reactivos) -->
  <div id="contador-caducidad" 
       class="alert alert-warning d-none mb-0" 
       role="alert" 
       style="cursor: pointer;">
    <strong id="contador-texto">0 reactivo(s) pr√≥ximo(s) a caducar</strong>
  </div>
            </div>
          </div>

          <!-- Color Buttons (solo para Reactivos) -->
          <div id="colorButtons" class="flex space-x-2 mt-4 hidden">
            <button id="btnMostrarTodos" class="bg-gray-400 text-white px-3 py-1 rounded">Todos</button>
            <button class="bg-green-500 text-white px-3 py-1 rounded">
              Verde
            </button>
            <button class="bg-yellow-800 text-white px-3 py-1 rounded">
              Caf√©
            </button>
            <button class="bg-blue-500 text-white px-3 py-1 rounded">
              Azul
            </button>
            <button class="bg-yellow-400 text-white px-3 py-1 rounded">
              Amarillo
            </button>
            <button
              class="bg-white border border-gray-400 px-3 py-1 rounded text-gray-700"
            >
              Blanco
            </button>
            <button class="bg-red-500 text-white px-3 py-1 rounded">
              Rojo
            </button>
          </div>

          <!-- Tabla de Materiales -->
<div id="tablaMateriales" class="bg-white rounded-lg shadow overflow-hidden mt-4">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-lab-table text-black">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad disponible</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Localizaci√≥n</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Capacidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de ingreso</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Observaciones</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for m in materiales %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.nombre }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.cantidad }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.cantidad_disponible }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.localizacion }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.capacidad }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.fecha_ingreso }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ m.observaciones }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        <button class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-edit"></i></button>
                        <button class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- üîπ Lista de reactivos pr√≥ximos a caducar -->
<div id="listaCaducidad" class="hidden bg-white rounded-lg shadow p-4 border border-gray-200 mb-4">
  <ul class="list-disc pl-6">
    {% for r in proximos_caducar %}
    <li class="text-gray-700">
      <strong>{{ r.nombre }}</strong> ‚Äî caduca el {{ r.fecha_caducidad }}
    </li>
    {% else %}
    <li class="text-gray-500 italic">No hay reactivos pr√≥ximos a caducar.</li>
    {% endfor %}
  </ul>
</div>


<!-- Tabla de Reactivos -->
<div id="tablaReactivos" class="bg-white rounded-lg shadow overflow-hidden mt-4 hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-lab-table text-black">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Color</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad en buen estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Cantidad disponible</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Localizaci√≥n</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Capacidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de ingreso</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Fecha de caducidad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Acciones</th>
                </tr>
            </thead>
            <tbody>
  {% for r in reactivos %}
  <tr class="hover:bg-gray-50" data-color="{{ r.color|lower }}">
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.nombre }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.color }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad_buen_estado }}</td>
      <td class="px-6 py-4 text-sm text-gray-900">{{ r.cantidad_disponible }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.localizacion }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.capacidad }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.fecha_ingreso }}</td>
      <td class="px-6 py-4 text-sm text-gray-500">{{ r.fecha_caducidad }}</td>
  </tr>
  {% endfor %}
</tbody>

        </table>
    </div>
</div>


          <!-- Descargar -->
          <div class="mt-6">
            <button
              class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors"
            >
              <i class="fas fa-download mr-2"></i>Descargar excel
            </button>
          </div>
        </div>
      </main>
    </div>

    <script>
  const btnMateriales = document.getElementById("btnMateriales");
  const btnReactivos = document.getElementById("btnReactivos");
  const tablaMateriales = document.getElementById("tablaMateriales");
  const tablaReactivos = document.getElementById("tablaReactivos");
  const colorButtons = document.getElementById("colorButtons");
  const contador = document.getElementById("contador-caducidad");
  const contadorTexto = document.getElementById("contador-texto");

  // üîπ Datos generados desde Flask
  // üîπ Datos generados desde Flask (directamente desde la consulta SQL)
const proximos = {{ proximos_caducar|length }};
const listaCaducan = {{ proximos_caducar|map(attribute='nombre')|list|tojson }};


  // Mostrar cantidad de reactivos pr√≥ximos a caducar
  contadorTexto.innerText = `${proximos} reactivo(s) pr√≥ximo(s) a caducar`;

  // üîπ Alternar entre Materiales y Reactivos
  btnMateriales.addEventListener("click", () => {
    tablaMateriales.classList.remove("hidden");
    tablaReactivos.classList.add("hidden");
    colorButtons.classList.add("hidden");
    contador.classList.add("hidden"); // Ocultar contador

    btnMateriales.classList.add("bg-lab-purple", "text-white");
    btnMateriales.classList.remove("bg-gray-200", "text-gray-700");
    btnReactivos.classList.add("bg-gray-200", "text-gray-700");
    btnReactivos.classList.remove("bg-lab-purple", "text-white");
  });

  btnReactivos.addEventListener("click", () => {
    tablaReactivos.classList.remove("hidden");
    tablaMateriales.classList.add("hidden");
    colorButtons.classList.remove("hidden");
    contador.classList.remove("hidden"); // Mostrar contador

    btnReactivos.classList.add("bg-lab-purple", "text-white");
    btnReactivos.classList.remove("bg-gray-200", "text-gray-700");
    btnMateriales.classList.add("bg-gray-200", "text-gray-700");
    btnMateriales.classList.remove("bg-lab-purple", "text-white");
  });

  // üîπ Mostrar alerta con la lista al hacer clic en el contador
  contador.addEventListener("click", () => {
    if (proximos > 0) {
      alert("Reactivos pr√≥ximos a caducar:\n\n" + listaCaducan.join("\n"));
    } else {
      alert("No hay reactivos pr√≥ximos a caducar üòä");
    }
  });

  // üîπ Filtro por color (para reactivos)
  const colorButtonsContainer = document.getElementById("colorButtons");
  const reactivoRows = document.querySelectorAll("#tablaReactivos tbody tr");

  colorButtonsContainer.querySelectorAll("button").forEach((btn) => {
    btn.addEventListener("click", () => {
      const color = btn.textContent.trim().toLowerCase();

      reactivoRows.forEach((row) => {
        const rowColor = row.dataset.color?.toLowerCase() || "";
        if (color === "todos") {
          row.style.display = "";
        } else if (color === "blanco") {
          row.style.display = rowColor === "blanco" ? "" : "none";
        } else {
          row.style.display = rowColor.includes(color) ? "" : "none";
        }
      });
    });
  });

  // üîπ B√∫squeda din√°mica
  document.getElementById("searchInput").addEventListener("input", (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const visibleTable = tablaMateriales.classList.contains("hidden")
      ? tablaReactivos
      : tablaMateriales;
    const rows = visibleTable.querySelectorAll("tbody tr");
    rows.forEach((row) => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(searchTerm) ? "" : "none";
    });
  });

  // üîπ Editar y Eliminar (demo)
  document.querySelectorAll(".fa-edit").forEach((button) => {
    button.addEventListener("click", () => {
      alert("Editar producto - Funcionalidad por implementar");
    });
  });
  document.querySelectorAll(".fa-trash").forEach((button) => {
    button.addEventListener("click", function () {
      if (confirm("¬øEst√°s seguro de eliminar este producto?")) {
        this.closest("tr").remove();
      }
    });
  });
</script>

  </body>
</html>
